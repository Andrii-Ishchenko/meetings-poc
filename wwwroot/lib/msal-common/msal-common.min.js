/*! @azure/msal-common v1.0.0-beta.2 2020-06-18 */
"use strict";!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).msalCommon={})}(this,function(y){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function e(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var u=function(){return(u=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function p(i,c,a,s){return new(a=a||Promise)(function(e,t){function r(e){try{o(s.next(e))}catch(e){t(e)}}function n(e){try{o(s.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}o((s=s.apply(i,c||[])).next())})}function m(r,n){var o,i,c,e,a={label:0,sent:function(){if(1&c[0])throw c[1];return c[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,i&&(c=2&t[0]?i.return:t[0]?i.throw||((c=i.return)&&c.call(i),0):i.next)&&!(c=c.call(i,t[1])).done)return c;switch(i=0,c&&(t=[2&t[0],c.value]),t[0]){case 0:case 1:c=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,i=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(c=0<(c=a.trys).length&&c[c.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!c||t[1]>c[0]&&t[1]<c[3])){a.label=t[1];break}if(6===t[0]&&a.label<c[1]){a.label=c[1],c=t;break}if(c&&a.label<c[2]){a.label=c[2],a.ops.push(t);break}c[2]&&a.ops.pop(),a.trys.pop();continue}t=n.call(r,a)}catch(e){t=[6,e],i=0}finally{o=c=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}function o(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],c=0,a=i.length;c<a;c++,o++)n[o]=i[c];return n}var i,t={unexpectedError:{code:"unexpected_error",desc:"Unexpected error in authentication."}},r=(e(c,i=Error),c.createUnexpectedError=function(e){return new c(t.unexpectedError.code,t.unexpectedError.desc+": "+e)},c);function c(e,t){var r=this,n=t?e+": "+t:e;return r=i.call(this,n)||this,Object.setPrototypeOf(r,c.prototype),r.errorCode=e,r.errorMessage=t,r.name="AuthError",r}var a,s="1.0.0-beta.2",d=s,l={clientInfoDecodingError:{code:"client_info_decoding_error",desc:"The client info could not be parsed/decoded correctly. Please review the trace to determine the root cause."},clientInfoEmptyError:{code:"client_info_empty_error",desc:"The client info was empty. Please review the trace to determine the root cause."},idTokenParsingError:{code:"id_token_parsing_error",desc:"ID token cannot be parsed. Please review stack trace to determine root cause."},nullOrEmptyIdToken:{code:"null_or_empty_id_token",desc:"The idToken is null or empty. Please review the trace to determine the root cause."},endpointResolutionError:{code:"endpoints_resolution_error",desc:"Error: could not resolve endpoints. Please check network and try again."},invalidAuthorityType:{code:"invalid_authority_type",desc:"The given authority is not a valid type of authority supported by MSAL. Please review the trace to determine the root cause."},hashNotDeserialized:{code:"hash_not_deserialized",desc:"The hash parameters could not be deserialized. Please review the trace to determine the root cause."},blankGuidGenerated:{code:"blank_guid_generated",desc:"The guid generated was blank. Please review the trace to determine the root cause."},stateMismatchError:{code:"state_mismatch",desc:"State mismatch error. Please check your network. Continued requests may cause cache overflow."},nonceMismatchError:{code:"nonce_mismatch",desc:"Nonce mismatch error. This may be caused by a race condition in concurrent requests."},accountMismatchError:{code:"account_mismatch",desc:"The cached account and account which made the token request do not match."},invalidIdToken:{code:"invalid_id_token",desc:"Invalid ID token format."},noTokensFoundError:{code:"no_tokens_found",desc:"No tokens were found for the given scopes, and no authorization code was passed to acquireToken. You must retrieve an authorization code before making a call to acquireToken()."},cacheParseError:{code:"cache_parse_error",desc:"Could not parse cache key."},userLoginRequiredError:{code:"user_login_error",desc:"User login is required."},multipleMatchingTokens:{code:"multiple_matching_tokens",desc:"The cache contains multiple tokens satisfying the requirements. Call AcquireToken again providing more requirements such as authority or account."},multipleMatchingAccounts:{code:"multiple_matching_accounts",desc:"The cache contains multiple accounts satisfying the given parameters. Please pass more info to obtain the correct account"},tokenRequestCannotBeMade:{code:"request_cannot_be_made",desc:"Token request cannot be made without authorization code or refresh token."},appendEmptyScopeError:{code:"cannot_append_empty_scope",desc:"Cannot append null or empty scope to ScopeSet. Please check the stack trace for more info."},removeEmptyScopeError:{code:"cannot_remove_empty_scope",desc:"Cannot remove null or empty scope from ScopeSet. Please check the stack trace for more info."},appendScopeSetError:{code:"cannot_append_scopeset",desc:"Cannot append ScopeSet due to error."},emptyInputScopeSetError:{code:"empty_input_scopeset",desc:"Empty input ScopeSet cannot be processed."},DeviceCodePollingCancelled:{code:"device_code_polling_cancelled",desc:"Caller has cancelled token endpoint polling during device code flow by setting DeviceCodeRequest.cancel = true."},DeviceCodeExpired:{code:"device_code_expired",desc:"Device code is expired."},NoAccountInSilentRequest:{code:"no_account_in_silent_request",desc:"Please pass an account object, silent flow is not supported without account information"}},E=(e(h,a=r),h.createClientInfoDecodingError=function(e){return new h(l.clientInfoDecodingError.code,l.clientInfoDecodingError.desc+" Failed with error: "+e)},h.createClientInfoEmptyError=function(e){return new h(l.clientInfoEmptyError.code,l.clientInfoEmptyError.desc+" Given Object: "+e)},h.createIdTokenParsingError=function(e){return new h(l.idTokenParsingError.code,l.idTokenParsingError.desc+" Failed with error: "+e)},h.createIdTokenNullOrEmptyError=function(e){return new h(l.nullOrEmptyIdToken.code,l.nullOrEmptyIdToken.desc+" Raw ID Token Value: "+e)},h.createEndpointDiscoveryIncompleteError=function(e){return new h(l.endpointResolutionError.code,l.endpointResolutionError.desc+" Detail: "+e)},h.createInvalidAuthorityTypeError=function(e){return new h(l.invalidAuthorityType.code,l.invalidAuthorityType.desc+" Given Url: "+e)},h.createHashNotDeserializedError=function(e){return new h(l.hashNotDeserialized.code,l.hashNotDeserialized.desc+" Given Object: "+e)},h.createStateMismatchError=function(){return new h(l.stateMismatchError.code,l.stateMismatchError.desc)},h.createNonceMismatchError=function(){return new h(l.nonceMismatchError.code,l.nonceMismatchError.desc)},h.createAccountMismatchError=function(){return new h(l.accountMismatchError.code,l.accountMismatchError.desc)},h.createInvalidIdTokenError=function(e){return new h(l.invalidIdToken.code,l.invalidIdToken.desc+" Given token: "+JSON.stringify(e))},h.createNoTokensFoundError=function(){return new h(l.noTokensFoundError.code,l.noTokensFoundError.desc)},h.createCacheParseError=function(e){return new h(l.cacheParseError.code,l.cacheParseError.desc+" Cache key: "+e)},h.createUserLoginRequiredError=function(){return new h(l.userLoginRequiredError.code,l.userLoginRequiredError.desc)},h.createMultipleMatchingTokensInCacheError=function(e){return new h(l.multipleMatchingTokens.code,"Cache error for scope "+e+": "+l.multipleMatchingTokens.desc+".")},h.createMultipleMatchingAccountsInCacheError=function(){return new h(l.multipleMatchingAccounts.code,l.multipleMatchingAccounts.desc)},h.createTokenRequestCannotBeMadeError=function(){return new h(l.tokenRequestCannotBeMade.code,l.tokenRequestCannotBeMade.desc)},h.createAppendEmptyScopeToSetError=function(e){return new h(l.appendEmptyScopeError.code,l.appendEmptyScopeError.desc+" Given Scope: "+e)},h.createRemoveEmptyScopeFromSetError=function(e){return new h(l.removeEmptyScopeError.code,l.removeEmptyScopeError.desc+" Given Scope: "+e)},h.createAppendScopeSetError=function(e){return new h(l.appendScopeSetError.code,l.appendScopeSetError.desc+" Detail Error: "+e)},h.createEmptyInputScopeSetError=function(e){return new h(l.emptyInputScopeSetError.code,l.emptyInputScopeSetError.desc+" Given ScopeSet: "+e)},h.createDeviceCodeCancelledError=function(){return new h(l.DeviceCodePollingCancelled.code,""+l.DeviceCodePollingCancelled.desc)},h.createDeviceCodeExpiredError=function(){return new h(l.DeviceCodeExpired.code,""+l.DeviceCodeExpired.desc)},h.createNoAccountInSilentRequestError=function(){return new h(l.NoAccountInSilentRequest.code,""+l.NoAccountInSilentRequest.desc)},h);function h(e,t){var r=a.call(this,e,t)||this;return r.name="ClientAuthError",Object.setPrototypeOf(r,h.prototype),r}var f,g=(C.decodeJwt=function(e){if(C.isEmpty(e))throw E.createIdTokenNullOrEmptyError(e);var t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(e);if(!t||t.length<4)throw E.createIdTokenParsingError("Given token is malformed: "+JSON.stringify(e));return{header:t[1],JWSPayload:t[2],JWSSig:t[3]}},C.isEmpty=function(e){return void 0===e||!e||0===e.length},C.queryStringToObject=function(e){function t(e){return decodeURIComponent(e.replace(n," "))}var r,n=/\+/g,o=/([^&=]+)=([^&]*)/g,i={};for(r=o.exec(e);r;)i[t(r[1])]=t(r[2]),r=o.exec(e);return i},C.trimAndConvertArrayEntriesToLowerCase=function(e){return e.map(function(e){return e.trim().toLowerCase()})},C.removeEmptyStringsFromArray=function(e){return e.filter(function(e){return!C.isEmpty(e)})},C);function C(){}(f=y.LogLevel||(y.LogLevel={}))[f.Error=0]="Error",f[f.Warning=1]="Warning",f[f.Info=2]="Info",f[f.Verbose=3]="Verbose";var T=(v.prototype.logMessage=function(e,t){if(!(t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii)){var r=(new Date).toUTCString(),n=(g.isEmpty(this.correlationId)?"["+r+"] : ":"["+r+"] : ["+this.correlationId+"]")+" : "+d+" : "+y.LogLevel[t.logLevel]+" - "+e;this.executeCallback(t.logLevel,n,t.containsPii)}},v.prototype.executeCallback=function(e,t,r){this.localCallback&&this.localCallback(e,t,r)},v.prototype.error=function(e,t){this.logMessage(e,{logLevel:y.LogLevel.Error,containsPii:!1,correlationId:t||""})},v.prototype.errorPii=function(e,t){this.logMessage(e,{logLevel:y.LogLevel.Error,containsPii:!0,correlationId:t||""})},v.prototype.warning=function(e,t){this.logMessage(e,{logLevel:y.LogLevel.Warning,containsPii:!1,correlationId:t||""})},v.prototype.warningPii=function(e,t){this.logMessage(e,{logLevel:y.LogLevel.Warning,containsPii:!0,correlationId:t||""})},v.prototype.info=function(e,t){this.logMessage(e,{logLevel:y.LogLevel.Info,containsPii:!1,correlationId:t||""})},v.prototype.infoPii=function(e,t){this.logMessage(e,{logLevel:y.LogLevel.Info,containsPii:!0,correlationId:t||""})},v.prototype.verbose=function(e,t){this.logMessage(e,{logLevel:y.LogLevel.Verbose,containsPii:!1,correlationId:t||""})},v.prototype.verbosePii=function(e,t){this.logMessage(e,{logLevel:y.LogLevel.Verbose,containsPii:!0,correlationId:t||""})},v.prototype.isPiiLoggingEnabled=function(){return this.piiLoggingEnabled||!1},v);function v(e){this.level=y.LogLevel.Info,e&&(this.localCallback=e.loggerCallback,this.piiLoggingEnabled=e.piiLoggingEnabled,this.level=e.logLevel)}var A,I,_={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",CACHE_PREFIX:"msal",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common",ADFS:"adfs",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",CODE_RESPONSE_TYPE:"code",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",FRAGMENT_RESPONSE_MODE:"fragment",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined"};(A||(A={})).CONTENT_TYPE="Content-Type",(I=y.PersistentCacheKeys||(y.PersistentCacheKeys={})).ID_TOKEN="idtoken",I.CLIENT_INFO="client.info",I.ADAL_ID_TOKEN="adal.idtoken",I.ERROR="error",I.ERROR_DESC="error.description";var S,O,R,w,k,N,b=["login.windows.net","login.chinacloudapi.cn","login.cloudgovapi.us","login.microsoftonline.com","login.microsoftonline.de","login.microsoftonline.us"],P=["login.microsoftonline.com","login.windows.net","login.windows-ppe.net","login.microsoft.com","sts.windows.net"],U="login.windows.net";(O=S=S||{}).COMMON="common",O.ORGANIZATIONS="organizations",O.CONSUMERS="consumers",(w=R=R||{}).CLIENT_ID="client_id",w.REDIRECT_URI="redirect_uri",w.RESPONSE_TYPE="response_type",w.RESPONSE_MODE="response_mode",w.GRANT_TYPE="grant_type",w.CLAIMS="claims",w.SCOPE="scope",w.ERROR="error",w.ERROR_DESCRIPTION="error_description",w.ACCESS_TOKEN="access_token",w.ID_TOKEN="id_token",w.REFRESH_TOKEN="refresh_token",w.EXPIRES_IN="expires_in",w.STATE="state",w.NONCE="nonce",w.PROMPT="prompt",w.SESSION_STATE="session_state",w.CLIENT_INFO="client_info",w.CODE="code",w.CODE_CHALLENGE="code_challenge",w.CODE_CHALLENGE_METHOD="code_challenge_method",w.CODE_VERIFIER="code_verifier",w.CLIENT_REQUEST_ID="client-request-id",w.X_CLIENT_SKU="x-client-SKU",w.X_CLIENT_VER="x-client-VER",w.X_CLIENT_OS="x-client-OS",w.X_CLIENT_CPU="x-client-CPU",w.POST_LOGOUT_URI="post_logout_redirect_uri",w.DEVICE_CODE="device_code",(N=k=k||{}).ISSUER="iss",N.OBJID="oid",N.SUBJECT="sub",N.TENANTID="tid",N.VERSION="ver",N.PREF_USERNAME="preferred_username",N.NAME="name",N.NONCE="nonce",N.EXPIRATION="exp",N.HOME_OBJID="home_oid",N.SESSIONID="sid",N.CLOUD_INSTANCE_HOSTNAME="cloud_instance_host_name";var D,M,L={LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none"};(M=D=D||{}).ACCOUNT="account",M.SID="sid",M.LOGIN_HINT="login_hint",M.ID_TOKEN="id_token",M.DOMAIN_HINT="domain_hint",M.ORGANIZATIONS="organizations",M.CONSUMERS="consumers",M.ACCOUNT_ID="accountIdentifier",M.HOMEACCOUNT_ID="homeAccountIdentifier";D.SID,D.LOGIN_HINT;var x,K,H,q,F,j,G,z,B,Y,V,Q={PLAIN:"plain",S256:"S256"};(x=y.ResponseMode||(y.ResponseMode={})).QUERY="query",x.FRAGMENT="fragment",x.FORM_POST="form_post",(H=K=K||{}).IMPLICIT_GRANT="implicit",H.AUTHORIZATION_CODE_GRANT="authorization_code",H.CLIENT_CREDENTIALS_GRANT="client_credentials",H.RESOURCE_OWNER_PASSWORD_GRANT="password",H.REFRESH_TOKEN_GRANT="refresh_token",H.DEVICE_CODE_GRANT="device_code",(F=q=q||{}).MSSTS_ACCOUNT_TYPE="MSSTS",F.ADFS_ACCOUNT_TYPE="ADFS",F.MSAV1_ACCOUNT_TYPE="MSA",F.GENERIC_ACCOUNT_TYPE="Generic",(G=j=j||{}).CACHE_KEY_SEPARATOR="-",G.CLIENT_INFO_SEPARATOR=".",(z=y.CredentialType||(y.CredentialType={})).ID_TOKEN="idtoken",z.ACCESS_TOKEN="accesstoken",z.REFRESH_TOKEN="refreshtoken",(B=y.CacheSchemaType||(y.CacheSchemaType={})).ACCOUNT="Account",B.CREDENTIAL="Credential",B.APP_META_DATA="AppMetadata",B.TEMPORARY="TempCache",(V=Y=Y||{})[V.ADFS=1001]="ADFS",V[V.MSA=1002]="MSA",V[V.MSSTS=1003]="MSSTS",V[V.GENERIC=1004]="GENERIC",V[V.ACCESS_TOKEN=2001]="ACCESS_TOKEN",V[V.REFRESH_TOKEN=2002]="REFRESH_TOKEN",V[V.ID_TOKEN=2003]="ID_TOKEN",V[V.APP_META_DATA=3001]="APP_META_DATA";var J="appmetadata",X={clientId:"",authority:null,knownAuthorities:[],redirectUri:"",postLogoutRedirectUri:""},W={storeInMemory:!0,tokenRenewalOffsetSeconds:300,telemetry:null},Z={loggerCallback:function(){},piiLoggingEnabled:!1,logLevel:y.LogLevel.Info},$={clear:function(){throw r.createUnexpectedError("Storage interface - clear() has not been implemented for the cacheStorage interface.")},containsKey:function(){throw r.createUnexpectedError("Storage interface - containsKey() has not been implemented for the cacheStorage interface.")},getItem:function(){throw r.createUnexpectedError("Storage interface - getItem() has not been implemented for the cacheStorage interface.")},getKeys:function(){throw r.createUnexpectedError("Storage interface - getKeys() has not been implemented for the cacheStorage interface.")},removeItem:function(){throw r.createUnexpectedError("Storage interface - removeItem() has not been implemented for the cacheStorage interface.")},setItem:function(){throw r.createUnexpectedError("Storage interface - setItem() has not been implemented for the cacheStorage interface.")},getCache:function(){throw r.createUnexpectedError("Storage interface - getCache() has not been implemented for the cacheStorage interface.")},setCache:function(){throw r.createUnexpectedError("Storage interface - setCache() has not been implemented for the cacheStorage interface.")}},ee={sendGetRequestAsync:function(){return p(this,void 0,void 0,function(){return m(this,function(e){throw r.createUnexpectedError("Network interface - sendGetRequestAsync() has not been implemented")})})},sendPostRequestAsync:function(){return p(this,void 0,void 0,function(){return m(this,function(e){throw r.createUnexpectedError("Network interface - sendPostRequestAsync() has not been implemented")})})}},te={createNewGuid:function(){throw r.createUnexpectedError("Crypto interface - createNewGuid() has not been implemented")},base64Decode:function(){throw r.createUnexpectedError("Crypto interface - base64Decode() has not been implemented")},base64Encode:function(){throw r.createUnexpectedError("Crypto interface - base64Encode() has not been implemented")},generatePkceCodes:function(){return p(this,void 0,void 0,function(){return m(this,function(e){throw r.createUnexpectedError("Crypto interface - generatePkceCodes() has not been implemented")})})}},re={sku:_.SKU,version:s,cpu:"",os:""};var ne,oe={redirectUriNotSet:{code:"redirect_uri_empty",desc:"A redirect URI is required for all calls, and none has been set."},postLogoutUriNotSet:{code:"post_logout_uri_empty",desc:"A post logout redirect has not been set."},claimsRequestParsingError:{code:"claims_request_parsing_error",desc:"Could not parse the given claims request object."},authorityUriInsecure:{code:"authority_uri_insecure",desc:"Authority URIs must use https.  Please see here for valid authority configuration options: https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-js-initializing-client-applications#configuration-options"},urlParseError:{code:"url_parse_error",desc:"URL could not be parsed into appropriate segments."},urlEmptyError:{code:"empty_url_error",desc:"URL was empty or null."},emptyScopesError:{code:"empty_input_scopes_error",desc:"Scopes cannot be passed as null, undefined or empty array because they are required to obtain an access token."},nonArrayScopesError:{code:"nonarray_input_scopes_error",desc:"Scopes cannot be passed as non-array."},clientIdSingleScopeError:{code:"clientid_input_scopes_error",desc:"Client ID can only be provided as a single scope."},invalidPrompt:{code:"invalid_prompt_value",desc:"Supported prompt values are 'login', 'select_account', 'consent' and 'none'.  Please see here for valid configuration options: https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-js-initializing-client-applications#configuration-options"},tokenRequestEmptyError:{code:"token_request_empty",desc:"Token request was empty and not found in cache."},invalidCodeChallengeMethod:{code:"invalid_code_challenge_method",desc:'code_challenge_method passed is invalid. Valid values are "plain" and "S256".'},invalidCodeChallengeParams:{code:"pkce_params_missing",desc:"Both params: code_challenge and code_challenge_method are to be passed if to be sent in the request"},b2cKnownAuthoritiesNotSet:{code:"b2c_known_authorities_not_set",desc:"Must set known authorities when validateAuthority is set to True and using B2C"},untrustedAuthority:{code:"untrusted_authority",desc:"The provided authority is not a trusted authority. If using B2C, please include this authority in the knownAuthorities config parameter."}},ie=(e(ce,ne=E),ce.createRedirectUriEmptyError=function(){return new ce(oe.redirectUriNotSet.code,oe.redirectUriNotSet.desc)},ce.createPostLogoutRedirectUriEmptyError=function(){return new ce(oe.postLogoutUriNotSet.code,oe.postLogoutUriNotSet.desc)},ce.createClaimsRequestParsingError=function(e){return new ce(oe.claimsRequestParsingError.code,oe.claimsRequestParsingError.desc+" Given value: "+e)},ce.createInsecureAuthorityUriError=function(e){return new ce(oe.authorityUriInsecure.code,oe.authorityUriInsecure.desc+" Given URI: "+e)},ce.createUrlParseError=function(e){return new ce(oe.urlParseError.code,oe.urlParseError.desc+" Given Error: "+e)},ce.createUrlEmptyError=function(){return new ce(oe.urlEmptyError.code,oe.urlEmptyError.desc)},ce.createScopesNonArrayError=function(e){return new ce(oe.nonArrayScopesError.code,oe.nonArrayScopesError.desc+" Given Scopes: "+e)},ce.createEmptyScopesArrayError=function(e){return new ce(oe.emptyScopesError.code,oe.emptyScopesError.desc+" Given Scopes: "+e)},ce.createClientIdSingleScopeError=function(e){return new ce(oe.clientIdSingleScopeError.code,oe.clientIdSingleScopeError.desc+" Given Scopes: "+e)},ce.createInvalidPromptError=function(e){return new ce(oe.invalidPrompt.code,oe.invalidPrompt.desc+" Given value: "+e)},ce.createEmptyTokenRequestError=function(){return new ce(oe.tokenRequestEmptyError.code,oe.tokenRequestEmptyError.desc)},ce.createInvalidCodeChallengeMethodError=function(){return new ce(oe.invalidCodeChallengeMethod.code,oe.invalidCodeChallengeMethod.desc)},ce.createInvalidCodeChallengeParamsError=function(){return new ce(oe.invalidCodeChallengeParams.code,oe.invalidCodeChallengeParams.desc)},ce.createKnownAuthoritiesNotSetError=function(){return new ce(oe.b2cKnownAuthoritiesNotSet.code,oe.b2cKnownAuthoritiesNotSet.desc)},ce.createUntrustedAuthorityError=function(){return new ce(oe.untrustedAuthority.code,oe.untrustedAuthority.desc)},ce);function ce(e,t){var r=ne.call(this,e,t)||this;return r.name="ClientConfigurationError",Object.setPrototypeOf(r,ce.prototype),r}var ae=(Object.defineProperty(se.prototype,"urlString",{get:function(){return this._urlString},enumerable:!0,configurable:!0}),se.prototype.canonicalizeUri=function(e){return(e=e&&e.toLowerCase())&&!e.endsWith("/")&&(e+="/"),e},se.prototype.validateAsUri=function(){var e;try{e=this.getUrlComponents()}catch(e){throw ie.createUrlParseError(e)}if(!e.HostNameAndPort||!e.PathSegments||e.PathSegments.length<1)throw ie.createUrlParseError("Given url string: "+this.urlString);if(!e.Protocol||"https:"!==e.Protocol.toLowerCase())throw ie.createInsecureAuthorityUriError(this.urlString)},se.prototype.urlRemoveQueryStringParameter=function(e){var t=new RegExp("(\\&"+e+"=)[^&]+");return this._urlString=this.urlString.replace(t,""),t=new RegExp("("+e+"=)[^&]+&"),this._urlString=this.urlString.replace(t,""),t=new RegExp("("+e+"=)[^&]+"),this._urlString=this.urlString.replace(t,""),this.urlString},se.prototype.replaceTenantPath=function(e){var t=this.getUrlComponents(),r=t.PathSegments;return!e||0===r.length||r[0]!==S.COMMON&&r[0]!==S.ORGANIZATIONS||(r[0]=e),se.constructAuthorityUriFromObject(t)},se.prototype.getHash=function(){var e=this.urlString.indexOf("#"),t=this.urlString.indexOf("#/");return-1<t?this.urlString.substring(t+2):-1<e?this.urlString.substring(e+1):""},se.prototype.getDeserializedHash=function(){var e=this.getHash(),t=g.queryStringToObject(e);if(!t)throw E.createHashNotDeserializedError(JSON.stringify(t));return t},se.prototype.getUrlComponents=function(){var e=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=this.urlString.match(e);if(!t)throw ie.createUrlParseError("Given url string: "+this.urlString);var r={Protocol:t[1],HostNameAndPort:t[4],AbsolutePath:t[5]},n=r.AbsolutePath.split("/");return n=n.filter(function(e){return e&&0<e.length}),r.PathSegments=n,r},se.constructAuthorityUriFromObject=function(e){return new se(e.Protocol+"//"+e.HostNameAndPort+"/"+e.PathSegments.join("/"))},se.hashContainsKnownProperties=function(e){if(g.isEmpty(e))return!1;var t=new se(e).getDeserializedHash();return!!(t.error_description||t.error||t.state)},se);function se(e){if(this._urlString=e,!g.isEmpty(this._urlString)&&g.isEmpty(this.getHash()))this._urlString=this.canonicalizeUri(e);else if(g.isEmpty(this._urlString))throw ie.createUrlEmptyError()}var ue,de=(Object.defineProperty(pe.prototype,"canonicalAuthority",{get:function(){return this._canonicalAuthority.urlString},set:function(e){this._canonicalAuthority=new ae(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null},enumerable:!0,configurable:!0}),Object.defineProperty(pe.prototype,"canonicalAuthorityUrlComponents",{get:function(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents},enumerable:!0,configurable:!0}),Object.defineProperty(pe.prototype,"tenant",{get:function(){return this.canonicalAuthorityUrlComponents.PathSegments[0]},enumerable:!0,configurable:!0}),Object.defineProperty(pe.prototype,"authorizationEndpoint",{get:function(){if(this.discoveryComplete())return this.replaceTenant(this.tenantDiscoveryResponse.authorization_endpoint);throw E.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},enumerable:!0,configurable:!0}),Object.defineProperty(pe.prototype,"tokenEndpoint",{get:function(){if(this.discoveryComplete())return this.replaceTenant(this.tenantDiscoveryResponse.token_endpoint);throw E.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},enumerable:!0,configurable:!0}),Object.defineProperty(pe.prototype,"deviceCodeEndpoint",{get:function(){if(this.discoveryComplete())return this.tenantDiscoveryResponse.token_endpoint.replace("/token","/devicecode");throw E.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},enumerable:!0,configurable:!0}),Object.defineProperty(pe.prototype,"endSessionEndpoint",{get:function(){if(this.discoveryComplete())return this.replaceTenant(this.tenantDiscoveryResponse.end_session_endpoint);throw E.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},enumerable:!0,configurable:!0}),Object.defineProperty(pe.prototype,"selfSignedJwtAudience",{get:function(){if(this.discoveryComplete())return this.replaceTenant(this.tenantDiscoveryResponse.issuer);throw E.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},enumerable:!0,configurable:!0}),pe.prototype.replaceTenant=function(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)},Object.defineProperty(pe.prototype,"defaultOpenIdConfigurationEndpoint",{get:function(){return this.canonicalAuthority+"v2.0/.well-known/openid-configuration"},enumerable:!0,configurable:!0}),pe.prototype.discoveryComplete=function(){return!!this.tenantDiscoveryResponse},pe.prototype.discoverEndpoints=function(t){return p(this,void 0,void 0,function(){return m(this,function(e){return[2,this.networkInterface.sendGetRequestAsync(t)]})})},pe.prototype.resolveEndpointsAsync=function(){return p(this,void 0,void 0,function(){var t,r;return m(this,function(e){switch(e.label){case 0:return[4,this.getOpenIdConfigurationEndpointAsync()];case 1:return t=e.sent(),[4,this.discoverEndpoints(t)];case 2:return r=e.sent(),this.tenantDiscoveryResponse=r.body,[2]}})})},pe);function pe(e,t){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t}(ue=y.AuthorityType||(y.AuthorityType={}))[ue.Aad=0]="Aad",ue[ue.Adfs=1]="Adfs",ue[ue.B2C=2]="B2C";var le,he=(e(fe,le=de),fe.setKnownAuthorities=function(e){0===fe.B2CTrustedHostList.length&&e.forEach(function(e){fe.B2CTrustedHostList.push(e)})},Object.defineProperty(fe.prototype,"authorityType",{get:function(){return y.AuthorityType.B2C},enumerable:!0,configurable:!0}),fe.prototype.getOpenIdConfigurationEndpointAsync=function(){return p(this,void 0,void 0,function(){return m(this,function(e){if(this.isInTrustedHostList(this.canonicalAuthorityUrlComponents.HostNameAndPort))return[2,this.defaultOpenIdConfigurationEndpoint];throw ie.createUntrustedAuthorityError()})})},fe.prototype.isInTrustedHostList=function(e){return-1<fe.B2CTrustedHostList.indexOf(e)},fe.B2CTrustedHostList=[],fe);function fe(e,t){return le.call(this,e,t)||this}function ye(e,t){if(g.isEmpty(e))throw E.createClientInfoEmptyError(e);try{var r=t.base64Decode(e);return JSON.parse(r)}catch(e){throw E.createClientInfoDecodingError(e)}}var me=(Ee.fromString=function(e){return new Ee((e=e||"").split(" "))},Ee.prototype.validateInputScopes=function(e){if(!e||e.length<1)throw ie.createEmptyScopesArrayError(e)},Ee.prototype.containsScope=function(e){return!g.isEmpty(e)&&this.scopes.has(e)},Ee.prototype.containsScopeSet=function(e){var t=this;return!!e&&this.scopes.size>=e.scopes.size&&e.asArray().every(function(e){return t.containsScope(e)})},Ee.prototype.appendScope=function(e){if(g.isEmpty(e))throw E.createAppendEmptyScopeToSetError(e);this.scopes.add(e.trim().toLowerCase())},Ee.prototype.appendScopes=function(e){var t=this;try{e.forEach(function(e){return t.scopes.add(e)})}catch(e){throw E.createAppendScopeSetError(e)}},Ee.prototype.removeScope=function(e){if(g.isEmpty(e))throw E.createRemoveEmptyScopeFromSetError(e);this.scopes.delete(e.trim().toLowerCase())},Ee.prototype.unionScopeSets=function(e){if(!e)throw E.createEmptyInputScopeSetError(e);return new Set(o(e.asArray(),Array.from(this.scopes)))},Ee.prototype.intersectingScopeSets=function(e){if(!e)throw E.createEmptyInputScopeSetError(e);var t=this.unionScopeSets(e),r=e.getScopeCount(),n=this.getScopeCount();return t.size<n+r},Ee.prototype.getScopeCount=function(){return this.scopes.size},Ee.prototype.asArray=function(){return Array.from(this.scopes)},Ee.prototype.printScopes=function(){return this.scopes?this.asArray().join(" "):""},Ee);function Ee(e){var t=e?g.trimAndConvertArrayEntriesToLowerCase(o(e)):[],r=t?g.removeEmptyStringsFromArray(t):[];this.validateInputScopes(r),this.scopes=new Set(r)}var ge=(Ce.toObject=function(e,t){for(var r in t)e[r]=t[r];return e},Ce.swap=function(e){var t={};for(var r in e)t[e[r]]=r;return t},Ce.renameKeys=function(r,n){var e=Object.keys(r).map(function(e){var t;return r[e]?((t={})[n[e]||e]=r[e],t):null});return Object.assign.apply(Object,o([{}],e))},Ce.matchHomeAccountId=function(e,t){return t===e.homeAccountId},Ce.matchEnvironment=function(e,t){return!(!P.includes(t)||!P.includes(e.environment))},Ce.matchCredentialType=function(e,t){return t.toLowerCase()===e.credentialType.toLowerCase()},Ce.matchClientId=function(e,t){return t===e.clientId},Ce.matchRealm=function(e,t){return t===e.realm},Ce.matchTarget=function(e,t){var r=me.fromString(e.target),n=me.fromString(t);return r.containsScopeSet(n)},Ce.getCredentialType=function(e){return-1!==e.indexOf(y.CredentialType.ACCESS_TOKEN)?y.CredentialType.ACCESS_TOKEN:-1!==e.indexOf(y.CredentialType.ID_TOKEN)?y.CredentialType.ID_TOKEN:-1!==e.indexOf(y.CredentialType.REFRESH_TOKEN)?y.CredentialType.REFRESH_TOKEN:_.NOT_DEFINED},Ce.isAppMetadata=function(e){return-1!==e.indexOf(J)},Ce.generateAccountCacheKey=function(e){return[e.homeAccountId,e.environment||"",e.tenantId||""].join(j.CACHE_KEY_SEPARATOR).toLowerCase()},Ce.generateAccountIdForCacheKey=function(e,t){return[e,t].join(j.CACHE_KEY_SEPARATOR).toLowerCase()},Ce.generateCredentialCacheKey=function(e,t,r,n,o,i,c){return[this.generateAccountIdForCacheKey(e,t),this.generateCredentialIdForCacheKey(r,n,o,c),this.generateTargetForCacheKey(i)].join(j.CACHE_KEY_SEPARATOR).toLowerCase()},Ce.generateCredentialIdForCacheKey=function(e,t,r,n){return[e,e===y.CredentialType.REFRESH_TOKEN&&n||t,r||""].join(j.CACHE_KEY_SEPARATOR).toLowerCase()},Ce.generateTargetForCacheKey=function(e){return(e||"").toLowerCase()},Ce.toIAccount=function(e){return{homeAccountId:e.homeAccountId,environment:e.environment,tenantId:e.realm,username:e.username}},Ce);function Ce(){}var Te=(ve.prototype.generateAccountId=function(){return[this.homeAccountId,this.environment].join(j.CACHE_KEY_SEPARATOR).toLowerCase()},ve.prototype.generateAccountKey=function(){return ge.generateAccountCacheKey({homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username})},ve.prototype.generateType=function(){switch(this.authorityType){case q.ADFS_ACCOUNT_TYPE:return Y.ADFS;case q.MSAV1_ACCOUNT_TYPE:return Y.MSA;case q.MSSTS_ACCOUNT_TYPE:return Y.MSSTS;case q.GENERIC_ACCOUNT_TYPE:return Y.GENERIC;default:return console.log("Unexpected account type"),null}},ve.createAccount=function(e,t,r,n,o){var i=new ve;i.authorityType=q.MSSTS_ACCOUNT_TYPE;var c=ye(i.clientInfo=e,o),a=""+c.uid+j.CLIENT_INFO_SEPARATOR+c.utid;i.homeAccountId=null!==n?a+j.CACHE_KEY_SEPARATOR+n:a;var s=t.canonicalAuthorityUrlComponents.HostNameAndPort;if(i.environment=P.includes(s)?U:s,i.realm=r.claims.tid,r){var u=g.isEmpty(r.claims.oid)?r.claims.sid:r.claims.oid;i.localAccountId=u,i.username=r.claims.preferred_username,i.name=r.claims.name}return i},ve.createADFSAccount=function(e,t){var r=new ve;return r.authorityType=q.ADFS_ACCOUNT_TYPE,r.homeAccountId=t.claims.sub,r.environment=e.canonicalAuthorityUrlComponents.HostNameAndPort,r.username=t.claims.upn,r},ve);function ve(){}var Ae=(Ie.prototype.generateAccountId=function(){return[this.homeAccountId,this.environment].join(j.CACHE_KEY_SEPARATOR).toLowerCase()},Ie.prototype.generateCredentialId=function(){var e=y.CredentialType.REFRESH_TOKEN&&this.familyId||this.clientId;return[this.credentialType,e,this.realm||""].join(j.CACHE_KEY_SEPARATOR).toLowerCase()},Ie.prototype.generateTarget=function(){return(this.target||"").toLowerCase()},Ie.prototype.generateCredentialKey=function(){return[this.generateAccountId(),this.generateCredentialId(),this.generateTarget()].join(j.CACHE_KEY_SEPARATOR).toLowerCase()},Ie.prototype.generateType=function(){switch(this.credentialType){case y.CredentialType.ID_TOKEN:return Y.ID_TOKEN;case y.CredentialType.ACCESS_TOKEN:return Y.ACCESS_TOKEN;case y.CredentialType.REFRESH_TOKEN:return Y.REFRESH_TOKEN;default:return console.log("Unexpected credential type"),null}},Ie);function Ie(){}var _e,Se=(e(Oe,_e=Ae),Oe.createIdTokenEntity=function(e,t,r,n,o){var i=new Oe;return i.credentialType=y.CredentialType.ID_TOKEN,i.homeAccountId=e,i.environment=t,i.clientId=n,i.secret=r,i.realm=o,i},Oe);function Oe(){return null!==_e&&_e.apply(this,arguments)||this}var Re=(we.nowSeconds=function(){return Math.round((new Date).getTime()/1e3)},we);function we(){}var ke,Ne=(e(be,ke=Ae),be.createAccessTokenEntity=function(e,t,r,n,o,i,c,a){var s=new be;s.homeAccountId=e,s.credentialType=y.CredentialType.ACCESS_TOKEN,s.secret=r;var u=Re.nowSeconds();return s.cachedAt=u.toString(),s.expiresOn=c.toString(),s.extendedExpiresOn=a.toString(),s.environment=t,s.clientId=n,s.realm=o,s.target=i,s},be);function be(){return null!==ke&&ke.apply(this,arguments)||this}var Pe,Ue=(e(De,Pe=Ae),De.createRefreshTokenEntity=function(e,t,r,n,o){var i=new De;return i.clientId=n,i.credentialType=y.CredentialType.REFRESH_TOKEN,i.environment=t,i.homeAccountId=e,i.secret=r,o&&(i.familyId=o),i},De);function De(){return null!==Pe&&Pe.apply(this,arguments)||this}var Me=(Le.prototype.generateAppMetaDataEntityKey=function(){return[J,this.environment,this.clientId].join(j.CACHE_KEY_SEPARATOR).toLowerCase()},Le);function Le(){}var xe=(Ke.toCacheMap={homeAccountId:"home_account_id",environment:"environment",realm:"realm",localAccountId:"local_account_id",username:"username",authorityType:"authority_type",name:"name",clientInfo:"client_info",lastModificationTime:"last_modification_time",lastModificationApp:"last_modification_app"},Ke.fromCacheMap=ge.swap(Ke.toCacheMap),Ke);function Ke(){}var He=(qe.toCacheMap={homeAccountId:"home_account_id",environment:"environment",credentialType:"credential_type",clientId:"client_id",secret:"secret",realm:"realm"},qe.fromCacheMap=ge.swap(qe.toCacheMap),qe);function qe(){}var Fe=(je.toCacheMap={homeAccountId:"home_account_id",environment:"environment",credentialType:"credential_type",clientId:"client_id",secret:"secret",realm:"realm",target:"target",cachedAt:"cached_at",expiresOn:"expires_on",extendedExpiresOn:"extended_expires_on",refreshOn:"refresh_on",keyId:"key_id",tokenType:"token_type"},je.fromCacheMap=ge.swap(je.toCacheMap),je);function je(){}var Ge=(ze.toCacheMap={homeAccountId:"home_account_id",environment:"environment",credentialType:"credential_type",clientId:"client_id",secret:"secret"},ze.fromCacheMap=ge.swap(ze.toCacheMap),ze);function ze(){}var Be=(Ye.toCacheMap={clientId:"client_id",environment:"environment",familyId:"family_id"},Ye.fromCacheMap=ge.swap(Ye.toCacheMap),Ye);function Ye(){}var Ve=(Qe.deserializeJSONBlob=function(e){return g.isEmpty(e)?{}:JSON.parse(e)},Qe.deserializeAccounts=function(n){var o={};return Object.keys(n).map(function(e){var t=ge.renameKeys(n[e],xe.fromCacheMap),r=new Te;ge.toObject(r,t),o[e]=r}),o},Qe.deserializeIdTokens=function(n){var o={};return Object.keys(n).map(function(e){var t=ge.renameKeys(n[e],He.fromCacheMap),r=new Se;ge.toObject(r,t),o[e]=r}),o},Qe.deserializeAccessTokens=function(n){var o={};return Object.keys(n).map(function(e){var t=ge.renameKeys(n[e],Fe.fromCacheMap),r=new Ne;ge.toObject(r,t),o[e]=r}),o},Qe.deserializeRefreshTokens=function(n){var o={};return Object.keys(n).map(function(e){var t=ge.renameKeys(n[e],Ge.fromCacheMap),r=new Ue;ge.toObject(r,t),o[e]=r}),o},Qe.deserializeAppMetadata=function(n){var o={};return Object.keys(n).map(function(e){var t=ge.renameKeys(n[e],Be.fromCacheMap),r=new Me;ge.toObject(r,t),o[e]=r}),o},Qe.deserializeAllCache=function(e){return{accounts:e.Account?this.deserializeAccounts(e.Account):{},idTokens:e.IdToken?this.deserializeIdTokens(e.IdToken):{},accessTokens:e.AccessToken?this.deserializeAccessTokens(e.AccessToken):{},refreshTokens:e.RefreshToken?this.deserializeRefreshTokens(e.RefreshToken):{},appMetadata:e.AppMetadata?this.deserializeAppMetadata(e.AppMetadata):{}}},Qe);function Qe(){}var Je=(Xe.mapAccountKeys=function(e,t){return ge.renameKeys(e[t],xe.toCacheMap)},Xe.mapIdTokenKeys=function(e,t){return ge.renameKeys(e[t],He.toCacheMap)},Xe.mapAccessTokenKeys=function(e,t){return ge.renameKeys(e[t],Fe.toCacheMap)},Xe.mapRefreshTokenKeys=function(e,t){return ge.renameKeys(e[t],Ge.toCacheMap)},Xe.mapAppMetadataKeys=function(e,t){return ge.renameKeys(e[t],Be.toCacheMap)},Xe);function Xe(){}var We=(Ze.serializeJSONBlob=function(e){return JSON.stringify(e)},Ze.serializeAccounts=function(t){var r={};return Object.keys(t).map(function(e){r[e]=Je.mapAccountKeys(t,e)}),r},Ze.serializeIdTokens=function(t){var r={};return Object.keys(t).map(function(e){r[e]=Je.mapIdTokenKeys(t,e)}),r},Ze.serializeAccessTokens=function(t){var r={};return Object.keys(t).map(function(e){r[e]=Je.mapAccessTokenKeys(t,e)}),r},Ze.serializeRefreshTokens=function(t){var r={};return Object.keys(t).map(function(e){r[e]=Je.mapRefreshTokenKeys(t,e)}),r},Ze.serializeAppMetadata=function(t){var r={};return Object.keys(t).map(function(e){r[e]=Je.mapAppMetadataKeys(t,e)}),r},Ze.serializeAllCache=function(e){return{Account:this.serializeAccounts(e.accounts),IdToken:this.serializeIdTokens(e.idTokens),AccessToken:this.serializeAccessTokens(e.accessTokens),RefreshToken:this.serializeRefreshTokens(e.refreshTokens),AppMetadata:this.serializeAppMetadata(e.appMetadata)}},Ze);function Ze(){}var $e=(et.prototype.generateInMemoryCache=function(e){return Ve.deserializeAllCache(Ve.deserializeJSONBlob(e))},et.prototype.generateJsonCache=function(e){return We.serializeAllCache(e)},et.prototype.getAllAccounts=function(){return this.getAccountsFilteredBy()},et.prototype.saveCacheRecord=function(e,t){this.saveAccount(e.account),this.saveCredential(e.idToken),this.saveAccessToken(e.accessToken,t),this.saveCredential(e.refreshToken)},et.prototype.saveAccount=function(e){var t=e.generateAccountKey();this.cacheStorage.setItem(t,e,y.CacheSchemaType.ACCOUNT,this.inMemory)},et.prototype.saveCredential=function(e){var t=e.generateCredentialKey();this.cacheStorage.setItem(t,e,y.CacheSchemaType.CREDENTIAL,this.inMemory)},et.prototype.saveAccessToken=function(e,t){var r=this,n=this.getCredentialsFilteredBy({clientId:e.clientId,credentialType:y.CredentialType.ACCESS_TOKEN,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm}),o=Object.values(n.accessTokens);o&&o.forEach(function(e){me.fromString(e.target).intersectingScopeSets(t)&&r.removeCredential(e)}),this.saveCredential(e)},et.prototype.getAccount=function(e){return this.cacheStorage.getItem(e,y.CacheSchemaType.ACCOUNT,this.inMemory)},et.prototype.getCredential=function(e){return this.cacheStorage.getItem(e,y.CacheSchemaType.CREDENTIAL,this.inMemory)},et.prototype.getAccountsFilteredBy=function(e){return this.getAccountsFilteredByInternal(e?e.homeAccountId:"",e?e.environment:"",e?e.realm:"")},et.prototype.getAccountsFilteredByInternal=function(n,o,i){var c=this,e=this.cacheStorage.getKeys(),a={};return e.forEach(function(e){var t=!0;if(ge.getCredentialType(e)===_.NOT_DEFINED&&!ge.isAppMetadata(e)){var r=c.cacheStorage.getItem(e,y.CacheSchemaType.ACCOUNT);g.isEmpty(n)||(t=ge.matchHomeAccountId(r,n)),g.isEmpty(o)||(t=t&&ge.matchEnvironment(r,o)),g.isEmpty(i)||(t=t&&ge.matchRealm(r,i)),t&&(a[e]=r)}}),a},et.prototype.getCredentialsFilteredBy=function(e){return this.getCredentialsFilteredByInternal(e.homeAccountId,e.environment,e.credentialType,e.clientId,e.realm,e.target)},et.prototype.getCredentialsFilteredByInternal=function(o,i,c,a,s,u){var d=this,e=this.cacheStorage.getKeys(),p={idTokens:{},accessTokens:{},refreshTokens:{}};return e.forEach(function(e){var t=!0,r=ge.getCredentialType(e);if(r!==_.NOT_DEFINED){var n=d.cacheStorage.getItem(e,y.CacheSchemaType.CREDENTIAL);if(g.isEmpty(o)||(t=ge.matchHomeAccountId(n,o)),g.isEmpty(i)||(t=t&&ge.matchEnvironment(n,i)),g.isEmpty(s)||(t=t&&ge.matchRealm(n,s)),g.isEmpty(c)||(t=t&&ge.matchCredentialType(n,c)),g.isEmpty(a)||(t=t&&ge.matchClientId(n,a)),g.isEmpty(u)||r!==y.CredentialType.ACCESS_TOKEN||(t=t&&ge.matchTarget(n,u)),t)switch(r){case y.CredentialType.ID_TOKEN:p.idTokens[e]=n;break;case y.CredentialType.ACCESS_TOKEN:p.accessTokens[e]=n;break;case y.CredentialType.REFRESH_TOKEN:p.refreshTokens[e]=n}}}),p},et.prototype.removeAccount=function(e){var t=this.getAccount(e);return this.removeAccountContext(t)&&this.cacheStorage.removeItem(e,y.CacheSchemaType.ACCOUNT,this.inMemory)},et.prototype.removeAccountContext=function(e){var r=this,t=this.cacheStorage.getKeys(),n=e.generateAccountId();return t.forEach(function(e){if(ge.getCredentialType(e)!==_.NOT_DEFINED){var t=r.cacheStorage.getItem(e,y.CacheSchemaType.CREDENTIAL,r.inMemory);t&&n===t.generateAccountId()&&r.removeCredential(t)}}),!0},et.prototype.removeCredential=function(e){var t=e.generateCredentialKey();return this.cacheStorage.removeItem(t,y.CacheSchemaType.CREDENTIAL,this.inMemory)},et);function et(e,t,r){this.cacheStorage=e,this.clientId=t,this.inMemory=r}var tt=(rt.prototype.createDefaultTokenRequestHeaders=function(){var e=this.createDefaultLibraryHeaders();return e.set(A.CONTENT_TYPE,_.URL_FORM_CONTENT_TYPE),e},rt.prototype.createDefaultLibraryHeaders=function(){var e=new Map;return e.set(""+R.X_CLIENT_SKU,this.config.libraryInfo.sku),e.set(""+R.X_CLIENT_VER,this.config.libraryInfo.version),e.set(""+R.X_CLIENT_OS,this.config.libraryInfo.os),e.set(""+R.X_CLIENT_CPU,this.config.libraryInfo.cpu),e},rt.prototype.executePostToTokenEndpoint=function(e,t,r){return this.networkClient.sendPostRequestAsync(e,{body:t,headers:r})},rt.prototype.getAllAccounts=function(){var e=this.unifiedCacheManager.getAllAccounts(),t=Object.values(e);return t.length<1?null:t.map(function(e){var t=JSON.parse(JSON.stringify(e));return ge.toIAccount(t)})},rt);function rt(e){var t,r,n,o,i,c,a,s;this.config=(r=(t=e).authOptions,n=t.systemOptions,o=t.loggerOptions,i=t.storageInterface,c=t.networkInterface,a=t.cryptoInterface,s=t.libraryInfo,{authOptions:u(u({},X),r),systemOptions:u(u({},W),n),loggerOptions:u(u({},Z),o),storageInterface:i||$,networkInterface:c||ee,cryptoInterface:a||te,libraryInfo:u(u({},re),s)}),this.logger=new T(this.config.loggerOptions),this.cryptoUtils=this.config.cryptoInterface,this.cacheStorage=this.config.storageInterface,this.unifiedCacheManager=new $e(this.cacheStorage,this.config.authOptions.clientId,this.config.systemOptions.storeInMemory),this.networkClient=this.config.networkInterface,he.setKnownAuthorities(this.config.authOptions.knownAuthorities),this.defaultAuthority=this.config.authOptions.authority}var nt,ot=(e(it,nt=de),Object.defineProperty(it.prototype,"authorityType",{get:function(){return y.AuthorityType.Aad},enumerable:!0,configurable:!0}),Object.defineProperty(it.prototype,"aadInstanceDiscoveryEndpointUrl",{get:function(){return _.AAD_INSTANCE_DISCOVERY_ENDPT+"?api-version=1.0&authorization_endpoint="+this.canonicalAuthority+"oauth2/v2.0/authorize"},enumerable:!0,configurable:!0}),it.prototype.getOpenIdConfigurationEndpointAsync=function(){return p(this,void 0,void 0,function(){return m(this,function(e){switch(e.label){case 0:return this.isInTrustedHostList(this.canonicalAuthorityUrlComponents.HostNameAndPort)?[2,this.defaultOpenIdConfigurationEndpoint]:[4,this.networkInterface.sendGetRequestAsync(this.aadInstanceDiscoveryEndpointUrl)];case 1:return[2,e.sent().body.tenant_discovery_endpoint]}})})},it.prototype.isInTrustedHostList=function(e){return b.includes(e)},it);function it(e,t){return nt.call(this,e,t)||this}var ct,at=(e(st,ct=de),Object.defineProperty(st.prototype,"authorityType",{get:function(){return y.AuthorityType.Adfs},enumerable:!0,configurable:!0}),st.prototype.getOpenIdConfigurationEndpointAsync=function(){return p(this,void 0,void 0,function(){return m(this,function(e){return[2,this.canonicalAuthority+".well-known/openid-configuration"]})})},st);function st(e,t){return ct.call(this,e,t)||this}var ut=(dt.detectAuthorityFromUrl=function(e){var t=new ae(e).getUrlComponents().PathSegments;return t.length&&t[0].toLowerCase()===_.ADFS?y.AuthorityType.Adfs:he.B2CTrustedHostList.length?y.AuthorityType.B2C:y.AuthorityType.Aad},dt.createInstance=function(e,t){if(g.isEmpty(e))throw ie.createUrlEmptyError();switch(dt.detectAuthorityFromUrl(e)){case y.AuthorityType.Aad:return new ot(e,t);case y.AuthorityType.B2C:return new he(e,t);case y.AuthorityType.Adfs:return new at(e,t);default:throw E.createInvalidAuthorityTypeError(""+e)}},dt);function dt(){}var pt=(lt.extractIdToken=function(e,t){var r=g.decodeJwt(e);if(!r)return null;try{var n=r.JWSPayload,o=t.base64Decode(n);return JSON.parse(o)}catch(e){throw E.createIdTokenParsingError(JSON.stringify(e))}},lt);function lt(e,t){if(g.isEmpty(e))throw E.createIdTokenNullOrEmptyError(e);this.rawIdToken=e,this.claims=lt.extractIdToken(e,t)}var ht=(ft.validateRedirectUri=function(e){if(g.isEmpty(e))throw ie.createRedirectUriEmptyError()},ft.validatePrompt=function(e){if([L.LOGIN,L.SELECT_ACCOUNT,L.CONSENT,L.NONE].indexOf(e)<0)throw ie.createInvalidPromptError(e)},ft.validateCodeChallengeParams=function(e,t){if(g.isEmpty(e)||g.isEmpty(t))throw ie.createInvalidCodeChallengeParamsError();this.validateCodeChallengeMethod(t)},ft.validateCodeChallengeMethod=function(e){if([Q.PLAIN,Q.S256].indexOf(e)<0)throw ie.createInvalidCodeChallengeMethodError()},ft.sanitizeEQParams=function(r,e){return r?(e.forEach(function(e,t){r[t]&&(console.log("Removed param "+t+" from extraQueryParameters since it was already present in library query parameters."),delete r[t])}),r):null},ft);function ft(){}var yt=(mt.prototype.addResponseTypeCode=function(){this.parameters.set(R.RESPONSE_TYPE,encodeURIComponent(_.CODE_RESPONSE_TYPE))},mt.prototype.addResponseMode=function(e){this.parameters.set(R.RESPONSE_MODE,encodeURIComponent(e||y.ResponseMode.QUERY))},mt.prototype.addScopes=function(e){this.parameters.set(R.SCOPE,encodeURIComponent(e.printScopes()))},mt.prototype.addClientId=function(e){this.parameters.set(R.CLIENT_ID,encodeURIComponent(e))},mt.prototype.addRedirectUri=function(e){ht.validateRedirectUri(e),this.parameters.set(R.REDIRECT_URI,encodeURIComponent(e))},mt.prototype.addDomainHint=function(e){this.parameters.set(D.DOMAIN_HINT,encodeURIComponent(e))},mt.prototype.addLoginHint=function(e){this.parameters.set(D.LOGIN_HINT,encodeURIComponent(e))},mt.prototype.addClaims=function(e){this.parameters.set(R.CLAIMS,encodeURIComponent(e))},mt.prototype.addCorrelationId=function(e){this.parameters.set(R.CLIENT_REQUEST_ID,encodeURIComponent(e))},mt.prototype.addLibraryInfo=function(e){this.parameters.set(R.X_CLIENT_SKU,e.sku),this.parameters.set(R.X_CLIENT_VER,e.version),this.parameters.set(R.X_CLIENT_OS,e.os),this.parameters.set(R.X_CLIENT_CPU,e.cpu)},mt.prototype.addPrompt=function(e){ht.validatePrompt(e),this.parameters.set(""+R.PROMPT,encodeURIComponent(e))},mt.prototype.addState=function(e){g.isEmpty(e)||this.parameters.set(R.STATE,encodeURIComponent(e))},mt.prototype.addNonce=function(e){this.parameters.set(R.NONCE,encodeURIComponent(e))},mt.prototype.addCodeChallengeParams=function(e,t){if(ht.validateCodeChallengeParams(e,t),!e||!t)throw ie.createInvalidCodeChallengeParamsError();this.parameters.set(R.CODE_CHALLENGE,encodeURIComponent(e)),this.parameters.set(R.CODE_CHALLENGE_METHOD,encodeURIComponent(t))},mt.prototype.addAuthorizationCode=function(e){this.parameters.set(R.CODE,encodeURIComponent(e))},mt.prototype.addDeviceCode=function(e){this.parameters.set(R.DEVICE_CODE,encodeURIComponent(e))},mt.prototype.addRefreshToken=function(e){this.parameters.set(R.REFRESH_TOKEN,encodeURIComponent(e))},mt.prototype.addCodeVerifier=function(e){this.parameters.set(R.CODE_VERIFIER,encodeURIComponent(e))},mt.prototype.addGrantType=function(e){this.parameters.set(R.GRANT_TYPE,encodeURIComponent(e))},mt.prototype.addClientInfo=function(){this.parameters.set("client_info","1")},mt.prototype.addExtraQueryParameters=function(t){var r=this;ht.sanitizeEQParams(t,this.parameters),Object.keys(t).forEach(function(e){r.parameters.set(e,t[e])})},mt.prototype.createQueryString=function(){var r=new Array;return this.parameters.forEach(function(e,t){r.push(t+"="+e)}),r.join("&")},mt);function mt(){this.parameters=new Map}var Et,gt=(e(Ct,Et=r),Ct);function Ct(e,t,r){var n=Et.call(this,e,t)||this;return n.name="ServerError",n.subError=r,Object.setPrototypeOf(n,Ct.prototype),n}var Tt,vt=["interaction_required","consent_required","login_required"],At=["message_only","additional_action","basic_action","user_password_expired","consent_required"],It=(e(_t,Tt=gt),_t.isInteractionRequiredError=function(e,t,r){var n=!g.isEmpty(e)&&-1<vt.indexOf(e),o=!g.isEmpty(r)&&-1<At.indexOf(r),i=!g.isEmpty(t)&&vt.some(function(e){return-1<t.indexOf(e)});return n||i||o},_t);function _t(e,t,r){var n=Tt.call(this,e,t,r)||this;return n.name="InteractionRequiredAuthError",Object.setPrototypeOf(n,_t.prototype),n}var St=function(e,t,r,n){this.account=e,this.idToken=t,this.accessToken=r,this.refreshToken=n},Ot=(Rt.prototype.validateServerAuthorizationCodeResponse=function(e,t,r){if(e.state!==t)throw E.createStateMismatchError();if(e.error||e.error_description||e.suberror){if(It.isInteractionRequiredError(e.error,e.error_description,e.suberror))throw new It(e.error,e.error_description,e.suberror);throw new gt(e.error,e.error_description,e.suberror)}e.client_info&&ye(e.client_info,r)},Rt.prototype.validateTokenResponse=function(e){if(e.error||e.error_description||e.suberror){if(It.isInteractionRequiredError(e.error,e.error_description,e.suberror))throw new It(e.error,e.error_description,e.suberror);var t=e.error_codes+" - ["+e.timestamp+"]: "+e.error_description+" - Correlation ID: "+e.correlation_id+" - Trace ID: "+e.trace_id;throw new gt(e.error,t)}e.client_info&&(this.clientInfo=ye(e.client_info,this.cryptoObj),g.isEmpty(this.clientInfo.uid)||g.isEmpty(this.clientInfo.utid)||(this.homeAccountIdentifier=this.clientInfo.uid+"."+this.clientInfo.utid))},Rt.prototype.generateAuthenticationResult=function(e,t,r){var n=new pt(e.id_token,this.cryptoObj);if(!g.isEmpty(r)&&n.claims.nonce!==r)throw E.createNonceMismatchError();var o=this.generateCacheRecord(e,n,t),i=me.fromString(e.scope);return this.uCacheManager.saveCacheRecord(o,i),{uniqueId:n.claims.oid||n.claims.sub,tenantId:n.claims.tid,scopes:i.asArray(),account:ge.toIAccount(o.account),idToken:n.rawIdToken,idTokenClaims:n.claims,accessToken:e.access_token,fromCache:!0,expiresOn:new Date(o.accessToken.expiresOn),extExpiresOn:new Date(o.accessToken.extendedExpiresOn),familyId:e.foci||null}},Rt.prototype.generateAccountEntity=function(e,t,r){var n=r.authorityType;if(!e.client_info)throw E.createClientInfoEmptyError(e.client_info);switch(n){case y.AuthorityType.B2C:return Te.createAccount(e.client_info,r,t,"policy",this.cryptoObj);case y.AuthorityType.Adfs:return Te.createADFSAccount(r,t);default:return Te.createAccount(e.client_info,r,t,null,this.cryptoObj)}},Rt.prototype.generateCacheRecord=function(e,t,r){var n=this.generateAccountEntity(e,t,r),o=r.canonicalAuthorityUrlComponents.HostNameAndPort,i=P.includes(o)?U:o,c=Se.createIdTokenEntity(this.homeAccountIdentifier,i,e.id_token,this.clientId,t.claims.tid),a=me.fromString(e.scope),s=Re.nowSeconds()+e.expires_in,u=s+e.ext_expires_in,d=Ne.createAccessTokenEntity(this.homeAccountIdentifier,i,e.access_token,this.clientId,t.claims.tid,a.asArray().join(" "),s,u),p=Ue.createRefreshTokenEntity(this.homeAccountIdentifier,i,e.refresh_token,this.clientId,e.foci);return new St(n,c,d,p)},Rt);function Rt(e,t,r,n){this.clientId=e,this.uCacheManager=t,this.cryptoObj=r,this.logger=n}var wt,kt=(e(Nt,wt=tt),Nt.prototype.createUrl=function(o){return p(this,void 0,void 0,function(){var t,r,n;return m(this,function(e){switch(e.label){case 0:if((t=o&&o.authority?ut.createInstance(o.authority,this.networkClient):this.defaultAuthority).authorityType==y.AuthorityType.Adfs)throw E.createInvalidAuthorityTypeError(t.canonicalAuthority);e.label=1;case 1:return e.trys.push([1,3,,4]),[4,t.resolveEndpointsAsync()];case 2:return e.sent(),[3,4];case 3:throw r=e.sent(),E.createEndpointDiscoveryIncompleteError(r);case 4:return[4,this.createUrlRequestParamString(o)];case 5:return n=e.sent(),[2,t.authorizationEndpoint+"?"+n]}})})},Nt.prototype.createUrlRequestParamString=function(o){return p(this,void 0,void 0,function(){var t,r,n;return m(this,function(e){return(t=new yt).addResponseTypeCode(),t.addClientId(this.config.authOptions.clientId),r=new me(o&&o.scopes||[]),o.extraScopesToConsent&&r.appendScopes(o&&o.extraScopesToConsent),t.addScopes(r),t.addRedirectUri(this.getRedirectUri()),n=o&&o.correlationId||this.config.cryptoInterface.createNewGuid(),t.addCorrelationId(n),t.addCodeChallengeParams(o.codeChallenge,o.codeChallengeMethod||""+_.S256_CODE_CHALLENGE_METHOD),t.addState(o.state),t.addNonce(o.nonce||this.config.cryptoInterface.createNewGuid()),t.addClientInfo(),t.addLibraryInfo(this.config.libraryInfo),o&&o.prompt&&t.addPrompt(o.prompt),o&&o.loginHint&&t.addLoginHint(o.loginHint),o&&o.domainHint&&t.addDomainHint(o.domainHint),o&&o.claims&&t.addClaims(o.claims),t.addResponseMode(y.ResponseMode.FRAGMENT),o&&o.extraQueryParameters&&t.addExtraQueryParameters(o&&o.extraQueryParameters),[2,t.createQueryString()]})})},Nt.prototype.acquireToken=function(c,a,s){return p(this,void 0,void 0,function(){var t,r,n,o,i;return m(this,function(e){switch(e.label){case 0:if(!c||g.isEmpty(c.code))throw E.createTokenRequestCannotBeMadeError();if((t=c&&c.authority?ut.createInstance(c.authority,this.networkClient):this.defaultAuthority).discoveryComplete())return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,t.resolveEndpointsAsync()];case 2:return e.sent(),[3,4];case 3:throw r=e.sent(),E.createEndpointDiscoveryIncompleteError(r);case 4:return(n=new yt).addClientId(this.config.authOptions.clientId),n.addRedirectUri(c.redirectUri||this.getRedirectUri()),o=new me(c.scopes||[]),n.addScopes(o),n.addAuthorizationCode(c.code),n.addCodeVerifier(c.codeVerifier),n.addGrantType(K.AUTHORIZATION_CODE_GRANT),n.addClientInfo(),i=t.tokenEndpoint,[4,this.getTokenResponse(i,n,t,s,a)];case 5:return[2,e.sent()]}})})},Nt.prototype.getValidToken=function(f){return p(this,void 0,void 0,function(){var t,r,n,o,i,c,a,s,u,d,p,l,h;return m(this,function(e){switch(e.label){case 0:if(!f)throw ie.createEmptyTokenRequestError();if(!f.account)throw E.createNoAccountInSilentRequestError();if(t=new me(f.scopes||[]),r=this.unifiedCacheManager.getAccount(ge.generateAccountCacheKey(f.account)),n=r.homeAccountId,o=r.environment,i=this.fetchAccessToken(n,o,t,r.realm),c=this.fetchRefreshToken(n,o),!i)throw E.createNoTokensFoundError();if(!f.forceRefresh&&!this.isTokenExpired(i.expiresOn))return[3,5];if(!c)throw E.createNoTokensFoundError();if((a=f.authority?ut.createInstance(f.authority,this.networkClient):this.defaultAuthority).authorityType===y.AuthorityType.Adfs)throw E.createInvalidAuthorityTypeError(a.canonicalAuthority);if(a.discoveryComplete())return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,a.resolveEndpointsAsync()];case 2:return e.sent(),[3,4];case 3:throw s=e.sent(),E.createEndpointDiscoveryIncompleteError(s);case 4:return u=a.tokenEndpoint,d={refreshToken:c.secret,scopes:f.scopes,authority:a.canonicalAuthority},[2,this.renewToken(d,a,u)];case 5:return p=this.fetchIdToken(n,o,r.realm),l=new pt(p.secret,this.cryptoUtils),h=me.fromString(i.target),[2,{uniqueId:l.claims.oid||l.claims.sub,tenantId:l.claims.tid,scopes:h.asArray(),idToken:l.rawIdToken,idTokenClaims:l.claims,accessToken:i.secret,fromCache:!0,account:ge.toIAccount(r),expiresOn:new Date(i.expiresOn),extExpiresOn:new Date(i.extendedExpiresOn),familyId:null,state:""}]}})})},Nt.prototype.logout=function(n,o){return p(this,void 0,void 0,function(){var t,r;return m(this,function(e){switch(e.label){case 0:this.unifiedCacheManager.removeAccount(ge.generateAccountCacheKey(n)),t="";try{t="?"+R.POST_LOGOUT_URI+"="+encodeURIComponent(this.getPostLogoutRedirectUri())}catch(e){}if((o=o||this.defaultAuthority).authorityType===y.AuthorityType.Adfs)throw E.createInvalidAuthorityTypeError(o.canonicalAuthority);if(o.discoveryComplete())return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,o.resolveEndpointsAsync()];case 2:return e.sent(),[3,4];case 3:throw r=e.sent(),E.createEndpointDiscoveryIncompleteError(r);case 4:return[2,""+o.endSessionEndpoint+t]}})})},Nt.prototype.handleFragmentResponse=function(e,t){var r=new Ot(this.config.authOptions.clientId,this.unifiedCacheManager,this.cryptoUtils,this.logger),n=new ae(e).getDeserializedHash();return r.validateServerAuthorizationCodeResponse(n,t,this.cryptoUtils),n.code},Nt.prototype.fetchIdToken=function(e,t,r){var n=ge.generateCredentialCacheKey(e,t,y.CredentialType.ID_TOKEN,this.config.authOptions.clientId,r);return this.unifiedCacheManager.getCredential(n)},Nt.prototype.fetchAccessToken=function(e,t,r,n){var o={homeAccountId:e,environment:t,credentialType:y.CredentialType.ACCESS_TOKEN,clientId:this.config.authOptions.clientId,realm:n,target:r.printScopes()},i=this.unifiedCacheManager.getCredentialsFilteredBy(o),c=Object.values(i.accessTokens);return!(1<c.length)&&c.length<1?null:c[0]},Nt.prototype.fetchRefreshToken=function(e,t){var r=ge.generateCredentialCacheKey(e,t,y.CredentialType.REFRESH_TOKEN,this.config.authOptions.clientId);return this.unifiedCacheManager.getCredential(r)},Nt.prototype.isTokenExpired=function(e){return(Number(e)||0)<Re.nowSeconds()+this.config.systemOptions.tokenRenewalOffsetSeconds},Nt.prototype.getTokenResponse=function(o,i,c,a,s){return p(this,void 0,void 0,function(){var t,r,n;return m(this,function(e){switch(e.label){case 0:return[4,this.networkClient.sendPostRequestAsync(o,{body:i.createQueryString(),headers:this.createDefaultTokenRequestHeaders()})];case 1:return t=e.sent(),(r=new Ot(this.config.authOptions.clientId,this.unifiedCacheManager,this.cryptoUtils,this.logger)).validateTokenResponse(t.body),(n=r.generateAuthenticationResult(t.body,c,a)).state=s,[2,n]}})})},Nt.prototype.renewToken=function(n,o,i){return p(this,void 0,void 0,function(){var t,r;return m(this,function(e){switch(e.label){case 0:return(t=new yt).addClientId(this.config.authOptions.clientId),t.addRedirectUri(this.getRedirectUri()),r=new me(n.scopes||[]),t.addScopes(r),t.addRefreshToken(n.refreshToken),t.addGrantType(K.REFRESH_TOKEN_GRANT),t.addClientInfo(),[4,this.getTokenResponse(i,t,o)];case 1:return[2,e.sent()]}})})},Nt.prototype.getRedirectUri=function(){if(this.config.authOptions.redirectUri){if("function"==typeof this.config.authOptions.redirectUri)return this.config.authOptions.redirectUri();if(!g.isEmpty(this.config.authOptions.redirectUri))return this.config.authOptions.redirectUri}throw ie.createRedirectUriEmptyError()},Nt.prototype.getPostLogoutRedirectUri=function(){if(this.config.authOptions.postLogoutRedirectUri){if("function"==typeof this.config.authOptions.postLogoutRedirectUri)return this.config.authOptions.postLogoutRedirectUri();if(!g.isEmpty(this.config.authOptions.postLogoutRedirectUri))return this.config.authOptions.postLogoutRedirectUri}throw ie.createPostLogoutRedirectUriEmptyError()},Nt.prototype.getAccount=function(e,t,r){var n=this.unifiedCacheManager.getAccountsFilteredBy({homeAccountId:e,environment:t,realm:r}),o=Object.keys(n).length;if(o<1)return null;if(1<o)throw E.createMultipleMatchingAccountsInCacheError();return n[0]},Nt);function Nt(e){var t=wt.call(this,e)||this;return he.setKnownAuthorities(t.config.authOptions.knownAuthorities),t}var bt,Pt=(e(Ut,bt=tt),Ut.prototype.getAuthCodeUrl=function(r){return p(this,void 0,void 0,function(){var t;return m(this,function(e){return t=this.createAuthCodeUrlQueryString(r),[2,this.defaultAuthority.authorizationEndpoint+"?"+t]})})},Ut.prototype.acquireToken=function(n){return p(this,void 0,void 0,function(){var t,r;return m(this,function(e){switch(e.label){case 0:return this.logger.info("in acquireToken call"),[4,this.executeTokenRequest(this.defaultAuthority,n)];case 1:return t=e.sent(),(r=new Ot(this.config.authOptions.clientId,this.unifiedCacheManager,this.cryptoUtils,this.logger)).validateTokenResponse(t.body),[2,r.generateAuthenticationResult(t.body,this.defaultAuthority)]}})})},Ut.prototype.executeTokenRequest=function(n,o){return p(this,void 0,void 0,function(){var t,r;return m(this,function(e){return t=this.createTokenRequestBody(o),r=this.createDefaultTokenRequestHeaders(),[2,this.executePostToTokenEndpoint(n.tokenEndpoint,t,r)]})})},Ut.prototype.createTokenRequestBody=function(e){var t=new yt;t.addClientId(this.config.authOptions.clientId),t.addRedirectUri(e.redirectUri);var r=new me(e.scopes||[]);return t.addScopes(r),t.addAuthorizationCode(e.code),e.codeVerifier&&t.addCodeVerifier(e.codeVerifier),t.addGrantType(K.AUTHORIZATION_CODE_GRANT),t.addClientInfo(),t.createQueryString()},Ut.prototype.createAuthCodeUrlQueryString=function(e){var t=new yt;t.addClientId(this.config.authOptions.clientId);var r=new me(e.scopes||[]);e.extraScopesToConsent&&r.appendScopes(e.extraScopesToConsent),t.addScopes(r),t.addRedirectUri(e.redirectUri);var n=e.correlationId||this.config.cryptoInterface.createNewGuid();return t.addCorrelationId(n),t.addResponseMode(e.responseMode),t.addResponseTypeCode(),t.addLibraryInfo(this.config.libraryInfo),e.codeChallenge&&t.addCodeChallengeParams(e.codeChallenge,e.codeChallengeMethod),e.state&&t.addState(e.state),e.prompt&&t.addPrompt(e.prompt),e.loginHint&&t.addLoginHint(e.loginHint),e.domainHint&&t.addDomainHint(e.domainHint),e.nonce&&t.addNonce(e.nonce),e.claims&&t.addClaims(e.claims),e.extraQueryParameters&&t.addExtraQueryParameters(e.extraQueryParameters),t.createQueryString()},Ut);function Ut(e){return bt.call(this,e)||this}var Dt,Mt=(e(Lt,Dt=tt),Lt.prototype.acquireToken=function(n){return p(this,void 0,void 0,function(){var t,r;return m(this,function(e){switch(e.label){case 0:return[4,this.getDeviceCode(n)];case 1:return t=e.sent(),n.deviceCodeCallback(t),[4,this.acquireTokenWithDeviceCode(n,t)];case 2:return r=e.sent(),[2,JSON.stringify(r)]}})})},Lt.prototype.getDeviceCode=function(n){return p(this,void 0,void 0,function(){var t,r;return m(this,function(e){return t=this.createQueryString(n),r=this.createDefaultLibraryHeaders(),[2,this.executePostRequestToDeviceCodeEndpoint(this.defaultAuthority.deviceCodeEndpoint,t,r)]})})},Lt.prototype.executePostRequestToDeviceCodeEndpoint=function(s,u,d){return p(this,void 0,void 0,function(){var t,r,n,o,i,c,a;return m(this,function(e){switch(e.label){case 0:return[4,this.networkClient.sendPostRequestAsync(s,{body:u,headers:d})];case 1:return t=e.sent().body,r=t.user_code,n=t.device_code,o=t.verification_uri,i=t.expires_in,c=t.interval,a=t.message,[2,{userCode:r,deviceCode:n,verificationUri:o,expiresIn:i,interval:c,message:a}]}})})},Lt.prototype.createQueryString=function(e){var t=new yt,r=new me(e.scopes||[]);return t.addScopes(r),t.addClientId(this.config.authOptions.clientId),t.createQueryString()},Lt.prototype.acquireTokenWithDeviceCode=function(u,n){return p(this,void 0,void 0,function(){var c,a,s,t,r=this;return m(this,function(e){return c=this.createTokenRequestBody(u,n),a=this.createDefaultTokenRequestHeaders(),s=Re.nowSeconds()+n.expiresIn,t=1e3*n.interval,[2,new Promise(function(n,o){var i=setInterval(function(){return p(r,void 0,void 0,function(){var t,r;return m(this,function(e){switch(e.label){case 0:return e.trys.push([0,5,,6]),u.cancel?(this.logger.error("Token request cancelled by setting DeviceCodeRequest.cancel = true"),clearInterval(i),o(E.createDeviceCodeCancelledError()),[3,4]):[3,1];case 1:return Re.nowSeconds()>s?(this.logger.error("Device code expired. Expiration time of device code was "+s),clearInterval(i),o(E.createDeviceCodeExpiredError()),[3,4]):[3,2];case 2:return[4,this.executePostToTokenEndpoint(this.defaultAuthority.tokenEndpoint,c,a)];case 3:(t=e.sent()).body&&t.body.error==_.AUTHORIZATION_PENDING?this.logger.info(t.body.error_description):(clearInterval(i),n(t.body)),e.label=4;case 4:return[3,6];case 5:return r=e.sent(),clearInterval(i),o(r),[3,6];case 6:return[2]}})})},t)})]})})},Lt.prototype.createTokenRequestBody=function(e,t){var r=new yt,n=new me(e.scopes||[]);return r.addScopes(n),r.addClientId(this.config.authOptions.clientId),r.addGrantType(K.DEVICE_CODE_GRANT),r.addDeviceCode(t.deviceCode),r.createQueryString()},Lt);function Lt(e){return Dt.call(this,e)||this}var xt,Kt=(e(Ht,xt=tt),Ht.prototype.acquireToken=function(n){return p(this,void 0,void 0,function(){var t,r;return m(this,function(e){switch(e.label){case 0:return[4,this.executeTokenRequest(n,this.defaultAuthority)];case 1:return t=e.sent(),(r=new Ot(this.config.authOptions.clientId,this.unifiedCacheManager,this.cryptoUtils,this.logger)).validateTokenResponse(t.body),[2,r.generateAuthenticationResult(t.body,this.defaultAuthority)]}})})},Ht.prototype.executeTokenRequest=function(n,o){return p(this,void 0,void 0,function(){var t,r;return m(this,function(e){return t=this.createTokenRequestBody(n),r=this.createDefaultTokenRequestHeaders(),[2,this.executePostToTokenEndpoint(o.tokenEndpoint,t,r)]})})},Ht.prototype.createTokenRequestBody=function(e){var t=new yt,r=new me(e.scopes||[]);return t.addScopes(r),t.addClientId(this.config.authOptions.clientId),t.addGrantType(K.REFRESH_TOKEN_GRANT),t.addClientInfo(),t.addRefreshToken(e.refreshToken),t.createQueryString()},Ht);function Ht(e){return xt.call(this,e)||this}var qt,Ft=(e(jt,qt=tt),jt.prototype.acquireToken=function(l){return p(this,void 0,void 0,function(){var t,r,n,o,i,c,a,s,u,d,p;return m(this,function(e){if(!l.account)throw E.createNoAccountInSilentRequestError();if(t=new me(l.scopes||[]),r=ge.generateAccountCacheKey(l.account),n=this.unifiedCacheManager.getAccount(r),o=n.homeAccountId,i=n.environment,c=this.readIdTokenFromCache(o,i,n.realm),a=new pt(c.secret,this.config.cryptoInterface),s=this.readAccessTokenFromCache(o,i,t,n.realm),u=this.readRefreshTokenFromCache(o,i),l.forceRefresh||!s||this.isTokenExpired(s.expiresOn)){if(!u)throw E.createNoTokensFoundError();return d=new Kt(this.config),p={scopes:l.scopes,refreshToken:u.secret,authority:l.authority},[2,d.acquireToken(p)]}return[2,{uniqueId:a.claims.oid||a.claims.sub,tenantId:a.claims.tid,scopes:t.asArray(),account:ge.toIAccount(n),idToken:c.secret,idTokenClaims:a.claims,accessToken:s.secret,fromCache:!0,expiresOn:new Date(s.expiresOn),extExpiresOn:new Date(s.extendedExpiresOn),familyId:null}]})})},jt.prototype.readIdTokenFromCache=function(e,t,r){var n=ge.generateCredentialCacheKey(e,t,y.CredentialType.ID_TOKEN,this.config.authOptions.clientId,r);return this.unifiedCacheManager.getCredential(n)},jt.prototype.readAccessTokenFromCache=function(e,t,r,n){var o={homeAccountId:e,environment:t,credentialType:y.CredentialType.ACCESS_TOKEN,clientId:this.config.authOptions.clientId,realm:n,target:r.printScopes()},i=this.unifiedCacheManager.getCredentialsFilteredBy(o),c=Object.values(i.accessTokens);return!(1<c.length)&&c.length<1?null:c[0]},jt.prototype.readRefreshTokenFromCache=function(e,t){var r=ge.generateCredentialCacheKey(e,t,y.CredentialType.REFRESH_TOKEN,this.config.authOptions.clientId);return this.unifiedCacheManager.getCredential(r)},jt.prototype.isTokenExpired=function(e){return(Number(e)||0)<Re.nowSeconds()+this.config.systemOptions.tokenRenewalOffsetSeconds},jt);function jt(e){return qt.call(this,e)||this}function Gt(){}var zt=(Bt.setRequestState=function(e,t){return g.isEmpty(e)?t:""+t+_.RESOURCE_DELIM+e},Bt.getUserRequestState=function(e){if(!g.isEmpty(e)){var t=e.indexOf(_.RESOURCE_DELIM);if(-1<t&&t+1<e.length)return e.substring(t+1)}return""},Bt);function Bt(){}y.AccessTokenEntity=Ne,y.AccountEntity=Te,y.AppMetadataEntity=Me,y.AuthError=r,y.AuthErrorMessage=t,y.AuthenticationResult=Gt,y.Authority=de,y.AuthorityFactory=ut,y.AuthorizationCodeClient=Pt,y.B2cAuthority=he,y.CacheHelper=ge,y.ClientAuthError=E,y.ClientAuthErrorMessage=l,y.ClientConfigurationError=ie,y.ClientConfigurationErrorMessage=oe,y.Constants=_,y.Credential=Ae,y.DEFAULT_SYSTEM_OPTIONS=W,y.Deserializer=Ve,y.DeviceCodeClient=Mt,y.IdToken=pt,y.IdTokenEntity=Se,y.InteractionRequiredAuthError=It,y.Logger=T,y.PromptValue=L,y.ProtocolUtils=zt,y.RefreshTokenClient=Kt,y.RefreshTokenEntity=Ue,y.SPAClient=kt,y.Serializer=We,y.ServerError=gt,y.SilentFlowClient=Ft,y.StringUtils=g,y.UnifiedCacheManager=$e,y.UrlString=ae,Object.defineProperty(y,"__esModule",{value:!0})});
//# sourceMappingURL=msal-common.min.js.map
